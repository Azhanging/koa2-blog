/**
*
*
* ajax-ask.js v1.0.0
* (c) 2016-2017 Blue
* https://github.com/azhanging/
* Released under the MIT License.
*Thu Jan 25 2018 11:38:32 GMT+0800 (中国标准时间)
*
**/
!function(t){function a(n){return k?j:this.constructor!==a?new a(n):(k=!0,this.config=t.extend(!0,N,n),this.constructor.$ask=this,j=this,void e.call(this))}function e(){s.call(this),n.call(this),i.call(this),r.call(this),l.call(this),c.call(this),o.call(this)}function n(){u.call(this,"get")}function i(){u.call(this,"post")}function r(){var a=this.config,e=this;t(a.ajaxForm).on("submit",a.ajaxFormDepute,function(){var a=t(this);return e.ajaxformHandler.apply(e,[{form:a}]),!1})}function o(){var a=this.config;t(a.openLayer).on("click",a.openLayerDepute,function(){var e=t(this),n=e.attr(a.layerWidth),i=e.attr(a.layerHeight),r=e.attr(a.urlName),o=e.attr(a.titleName)||"信息";layer.open({title:o,type:2,area:[n||"700px",i||"450px"],fixed:!1,maxmin:!0,shadeClose:!0,content:r||""})})}function c(){var a=this.config;t(a.msg).on("click",function(){var e=t(this),n=e.attr(a.contentName),i=e.attr(a.typeName);layer.msg(n,{icon:i})})}function l(){var a=this.config;t(a.alert).on("click",function(){var e=t(this),n=e.attr(a.contentName),i=e.attr(a.titleName),r=e.attr(a.skinName);layer.alert(n,{title:i,skin:r||"layui-layer-molv",closeBtn:1})})}function s(){"function"==typeof t.fn.Validform&&(this.valiform=t(this.config.valiform).Validform(this.config.valiformConfig))}function u(a){var e=this,n=this.config;t(n[a]).on("click",n.depute,function(i){v();var r,o=t(this),c=o.closest("form"),l=new Function("return "+o.attr(n.stopPropagationName))(),s="",u={},p=m.call(e,o);return h.call(this)?void d.call(this,{ctx:e,method:a}):(r=g(),p?(s=o.attr(n.urlName),u=new Function("return "+o.attr(n.dataName))()):(s=c.attr("action"),u=c.serialize()),f.call(e,{type:a,action:s,form:c,btn:o,ajaxData:u,loadIndex:r}),l||!1)})}function f(a){var e=this,n=a.loadIndex,i=this.config;t.ajax({async:e.config.async,type:a.type,url:a.action,data:a.ajaxData,success:function(t){v(n),i.success.apply(e,[t,a.btn])},error:function(t){v(n),i.error.apply(e,[t])}})}function m(t){return t.attr(this.config.urlName)||!1}function h(){var a=t(this).attr("confirm");return!(!a||"true"!=a.trim())}function d(a){var e=t(this),n=a.ctx.config,i=e.attr(n.contentName)||"",r=e.attr(n.titleName)||"";layer.confirm.apply(null,[i,{title:r||!1,btn:n.btn,closeBtn:!!new Function("return "+e.attr("close"))()&&1,target:e,ctx:a.ctx,method:a.method}].concat(n.btnHandler))}function p(){var a=t(this.target[0]),e=this.ctx,n=new Function("return "+a.attr(N.dataName))(),i=this.method,r=a.attr(e.config.urlName),o=g();f.call(e,{type:i,action:r,btn:a,ajaxData:n,loadIndex:o})}function y(t,a){var e=this.config.redirectTime;t&&setTimeout(function(){"true"==a||"parent"==a?parent.location.href=t:"top"==a?top.location.href=t:location.href=t},e)}function g(){return layer.load(1)}function v(t){t?layer.close(t):layer.closeAll()}var x=/iPhone|Android|Windows Phone|KFAPWI|MeeGo/.test(navigator.userAgent),N={valiform:".valiform",valiformConfig:{tiptype:!x&&3,datatype:{gphone:/^\d{9,14}$/,telphone:/^\d{3,4}-\d{7,8}$/}},titleName:"data-title",contentName:"data-content",skinName:"data-skin",typeName:"data-type",layerWidth:"data-width",layerHeight:"data-height",urlName:"data-url",dataName:"ajax-data",redirectUrlName:"data-redirect-url",parentRedirectName:"data-parent-redirect",stopPropagationName:"data-stop",async:!0,get:".ask-get",post:".ask-post",depute:"",ajaxForm:".ask-form",ajaxFormDepute:"",openLayer:".ask-open-layer",openLayerDepute:"",alert:".ask-alert",msg:".ask-msg",redirectTime:1e3,btn:["确认","取消"],btnHandler:[function(){p.call(this)},function(){layer.closeAll()}],success:function(t,a){var e=this.config,n=t.info;0!=t.status&&n?layer.msg(n,{icon:1}):0==t.status&&n&&layer.msg(n,{icon:2});var i=t.url||a&&0!=t.status&&a.attr(e.redirectUrlName)||!1;y.apply(this,[i,a.attr(e.parentRedirectName)||!1])},error:function(t){layer.msg(t.info,{icon:2}),y.call(this,t.url)}},k=!1,j={};a.prototype.ajaxformHandler=function(t){var a=t.form,e=a.attr("method")||"get",n=a.attr("action")||"",i=a.serialize(),r=g();f.call(this,{type:e,action:n,form:a,btn:a,ajaxData:i,loadIndex:r})},t.ajaxAsk=a}($||jQuery);